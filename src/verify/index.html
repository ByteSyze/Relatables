<?php
	/*Copyright (C) Tyler Hackett 2014*/
	
	session_start();
	
	if(!isset($_GET["user"]))
		die("No user specified");
	else if(!isset($_GET["v"]))
		die("No authentication set");
		
	$user = $_GET["user"];
	$verification = $_GET["v"];
	
	$connection = mysqli_connect("mysql.a78.org","u683362690_insom","10102S33K3R17","u683362690_rtblz");
	
	if($statement = $connection->prepare("SELECT password, email FROM accounts WHERE username LIKE (?) AND pending = 1"))
	{
		$statement->bind_param("s",$user);
		
		$statement->execute();
		
		$statement->store_result();
		$statement->bind_result($pass, $email);
		$result = $statement->fetch();
		
		$resultVerification = md5($user . $pass . $email);
		
		if($verification == $resultVerification)
		{
			if($statement = $connection->prepare("UPDATE accounts SET pending=0 WHERE username LIKE (?)"))
			{
				$statement->bind_param("s",$user);
				
				$statement->execute();
				
				$_SESSION["username"] = $user;
				
				header("Location: http://www.relatablez.com/?verified=true");
			}
		}
		else
		{
			header("Location: http://www.relatablez.com/?verified=false");
		}
	}

?>