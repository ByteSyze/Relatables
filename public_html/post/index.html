<?php
	session_start();
	
	require($_SERVER['DOCUMENT_ROOT'] . '/global.php');
	
	$pid = $_GET['id'];
	
	//If post id ends in a /, remove it.
	$slashpos = strpos($pid,'/');
	
	if($slashpos != false)
		$pid = substr($pid,0,$slashpos);
	
	$post = new Post($pid);
?>
<!DOCTYPE html>
<!-- Copyright (C) Tyler Hackett 2014-->
<html>
	<head>
		<title>Relatablez</title>
		
		<?php 
			GlobalUtils::getMeta();
			GlobalUtils::getCSS('submissiontheme');
		?>
		
		<link rel="canonical" href="http://www.relatablez.com/">
	</head>
	<body>
		<?php require($_SERVER["DOCUMENT_ROOT"] . "/navigation.php"); ?>
		
		<div class="grid wrap wider">
			<div class="unit two-thirds">
				<div class="boxes">
					<?php $post->format(); ?>
					<div class="box">
						<div class="box-content">
							<div id='comment-submit'>
								<form action='/comment.php' method='POST'>
									<textarea class="input-submit" placeholder="Join the discussion!" id='comment-submit-text' name='c'></textarea>
									<div class="buttons">
										<button class="button blue-hover" id='comment-submit-button' type='submit'>Post</button>
									</div>
								</form>
							</div>
						</div>
					</div>
					<div class="box">
						<span class="box-title">Comments (<span id='comment-count'><?php echo $post->getCommentCount(); ?></span>)</span>
						<div class="box-content" id="comments">
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script>var pid = <?php echo $pid; ?>;</script>
		<?php GlobalUtils::getJS('vote', 'post/post'); ?>
	</body>
</html>